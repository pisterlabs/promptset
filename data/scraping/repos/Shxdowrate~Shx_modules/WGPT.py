# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
#   â–ˆâ–€ â–ˆ â–ˆ â–€â–„â–€ â–ˆâ–€â–„ â–ˆâ–€â–ˆ â–ˆ â–ˆ â–ˆ â–ˆâ–€â–ˆ â–„â–€â–ˆ â–€â–ˆâ–€ â–ˆâ–€â–€  Channel: https://t.me/mescr_m
#   â–„â–ˆ â–ˆâ–€â–ˆ â–ˆ â–ˆ â–ˆâ–„â–€ â–ˆâ–„â–ˆ â–€â–„â–€â–„â–€ â–ˆâ–€â–„ â–ˆâ–€â–ˆ  â–ˆ  â–ˆâ–ˆâ–„  Not licensed
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”                         
#   â–ˆâ–€â–€â€ƒâ–€â–„â–€â€ƒâ–ˆâ–€â–€â€ƒâ–ˆ  â€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–€â€ƒâ–ˆâ€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–€â–€   â–ˆâ–€â–„â–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–„â€ƒâ–ˆ â–ˆâ€ƒâ–ˆ  â€ƒâ–ˆâ–€â–€
#   â–ˆâ–ˆâ–„â€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–„â–ˆâ€ƒâ–„â–ˆâ€ƒâ–ˆâ€ƒâ–€â–„â–€â€ƒâ–ˆâ–ˆâ–„   â–ˆ â–€ â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–€â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–ˆâ–„
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# idea: 
# meta developer: @mescr_m
# requires: openai
# thanks: 
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

import openai
from .. import loader, utils

__version__ = (1, 0, 0)

class WGPT(loader.Module):
    """ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ Ğ¸ÑĞºÑƒÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ñ‚ĞµĞ»ĞµĞºÑ‚Ğ°\nĞ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ±ĞµĞ· ĞºĞ¾Ğ¼Ğ¼Ğ°Ğ½Ğ´, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ: // Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚\nDeveloper: @mescr_m"""
    strings = {
        "name": "WGPT",
        'api_key': 'API ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.'
    }
    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "api_key",None,
                lambda: self.strings['api_key'],
                validator=loader.validators.Hidden(),
            ),
        )

    @loader.watcher(out = True)
    async def watcher(self, message):
        messages = message.raw_text
        prefix = utils.escape_html(self.get_prefix())
        messaged = messages.split(' ')
        ttt = messaged[0]
        prefixx = self.db.get(self.name, 'prefix')
        mono = self.db.get(self.name, 'mono')
        
        if ttt == prefixx:
            if self.config['api_key'] == None:
                await message.reply(f'Ğ£ Ğ²Ğ°Ñ Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ API ĞºĞ»ÑÑ‡. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ <code>{prefix}config WGPT</code>.')
                return
            if mono == True:
                m1 = '<code>'
                m2 = '</code>'
            else:
                m1 = ''
                m2 = ''
            messagef = message.raw_text
            openai.api_key = self.config["api_key"]
            model_engine = "text-davinci-003"
            completion = openai.Completion.create(
                engine=model_engine,
                prompt=messagef,
                max_tokens=1024,
                n=1,
                stop=None,
                temperature=0.5,
            )
            response = completion.choices[0].text
            await message.reply(f"<b>GPT: </b>{m1}{response}{m2}")

    async def client_ready(self, client, db):
        self.client = client
        self.db = db
        aa = self.db.get(self.name, 'prefix')
        if aa == None:
            self.db.set(self.name, 'prefix', '//')
        bb = self.db.get(self.name, 'mono')
        if bb == None:
            self.db.set(self.name, 'mono', 'False')

    @loader.command()
    async def gptsettings(self, message):
        ''' - Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ\nprefix - Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ\nmono - Ğ²Ñ‹Ğ´ĞµĞ»ÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ GPT Ğ¼Ğ¾Ğ½Ğ¾ÑˆĞ¸Ñ€Ğ½Ñ‹Ğ¼ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ¾Ğ¼?'''
        aa = self.db.get(self.name, 'prefix')
        bb = self.db.get(self.name, 'mono')
        prefix = utils.escape_html(self.get_prefix())
        args = utils.get_args_raw(message)
        if args == 'prefix':
            await utils.answer(message, f'<emoji document_id=5784993237412351403>âœ…</emoji> Ğ’Ğ°Ñˆ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ "<code>{aa}</code>".')
            return
        if 'prefix ' in args:
            args = args.split()
            if args[0] == 'prefix':
                self.db.set(self.name, 'prefix', args[1])
                await utils.answer(message, f'<emoji document_id=5784993237412351403>âœ…</emoji> Ğ’Ğ°Ñˆ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° <code>{args[1]}</code>')
                return
        if args == 'mono':
            if bb == True:
                self.db.set(self.name, 'mono', False)
                bbs = '<emoji document_id=5784993237412351403>âœ…</emoji> ĞÑ‚Ğ²ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ²Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ¼Ğ¾Ğ½Ğ¾ÑˆĞ¸Ñ€Ğ½Ñ‹Ğ¼ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ¾Ğ¼.'
                
            else:
                bbs = '<emoji document_id=5784993237412351403>âœ…</emoji> ĞÑ‚Ğ²ĞµÑ‚ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ¼Ğ¾Ğ½Ğ¾ÑˆĞ¸Ñ€Ğ½Ñ‹Ğ¼ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ¾Ğ¼.'
                self.db.set(self.name, 'mono', True)
            await utils.answer(message, bbs)
            return
        elif not args:
            await utils.answer(message, f'<emoji document_id=5877477244938489129>ğŸš«</emoji> <b>Error |</b> <code>{prefix}gptsettings</code>\nĞ’Ñ‹ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€.')
            return
        else:
            await utils.answer(message, f'ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ° <code>{args}</code> Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚.')
            return
        
        
        
